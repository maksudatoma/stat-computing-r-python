<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2023-04-10">
<title>Statistical Computing using R and Python - 24&nbsp; Functional Programming</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../part-wrangling/09-spatial-formats.html" rel="next">
<link href="../part-wrangling/07-datetime.html" rel="prev">
<link href="../build_deps/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4ZFBDKXJXP"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4ZFBDKXJXP', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="../build_deps/style.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Functional Programming</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Computing using R and Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/srvanderplas/stat-computing-r-python/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-tools/00-tools-intro.html" class="sidebar-item-text sidebar-link">Part I: Tools</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/01-computer-basics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Computer Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/02-setting-up-computer.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Setting Up Your Computer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/03-scripts-notebooks.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Scripts and Notebooks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/04-Rstudio-interface.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RStudio’s Interface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-tools/05-git-and-github.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Version Control with Git</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-gen-prog/00-gen-prog.html" class="sidebar-item-text sidebar-link">Part II: General Programming</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/00-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Programming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/01-basic-var-types.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Variables and Basic Data Types</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/02-prog-functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Using Functions and Libraries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/03-data-struct.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/035-matrix-calcs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Matrix Calculations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/04-control-struct.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Control Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/05-functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Writing Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-gen-prog/06-debugging.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Debugging</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../part-wrangling/00-wrangling.html" class="sidebar-item-text sidebar-link">Part III: Data Wrangling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/01-data-input.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Input</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02-basic-data-vis.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Data Visualization Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02a-eda.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02b-graphics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Data Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/02c-good-graphics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Creating Good Charts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/03-data-cleaning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Data Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/04-strings.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Working with Strings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/05-data-reshape.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Reshaping Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/06-data-join.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Joining Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/07-datetime.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Dates and Times</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/08-functional-prog.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Functional Programming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../part-wrangling/09-spatial-formats.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Spatial data</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../graveyard.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Other Topics</span></a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#programming-philosophies" id="toc-programming-philosophies" class="nav-link active" data-scroll-target="#programming-philosophies"><span class="toc-section-number">24.1</span>  Programming Philosophies</a></li>
  <li><a href="#replacing-loops-with-functional-programming" id="toc-replacing-loops-with-functional-programming" class="nav-link" data-scroll-target="#replacing-loops-with-functional-programming"><span class="toc-section-number">24.2</span>  Replacing Loops with Functional Programming</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="toc-section-number">24.3</span>  References</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/srvanderplas/stat-computing-r-python/edit/main/part-wrangling/08-functional-prog.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-lists" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Functional Programming</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 10, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header><p>In this section, we’re going to change focus slightly from learning specific functions to learning programming <strong>patterns</strong>. We’re going to start this process by talking about functional programming and its connection to lists. While this topic may be a bit advanced if you’re just starting to learn how to program, it may help to skim through the deeper explanation so that you can at least recognize some of these words if you encounter them later.</p>
<section id="programming-philosophies" class="level2 page-columns page-full" data-number="24.1"><h2 data-number="24.1" class="anchored" data-anchor-id="programming-philosophies">
<span class="header-section-number">24.1</span> Programming Philosophies</h2>
<div class="callout-advanced callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Advanced
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section is intended for everyone, but I do not expect that people who are just learning to program for the first time will fully absorb everything in this section. Get what you can out of this, use it to improve how you write code, and come back to it later if it’s too confusing.</p>
</div>
</div>
<p>Just as spoken languages fall into families, like Indo-European or Sino-Tibetan, programming languages also have broad classifications. Here are a few “families” or classifications of programming languages <span class="citation" data-cites="kuchlingFunctionalProgrammingHOWTO2022"><a href="#ref-kuchlingFunctionalProgrammingHOWTO2022" role="doc-biblioref">[1]</a></span>:</p>
<ul>
<li>Many languages are <strong>procedural</strong>: a program provides a list of instructions that tell the computer what to do with provided input. C, Pascal, Fortran, and UNIX shells are naturally procedural. JavaScript is also a fairly natural procedural language. Many R analysis scripts are also naturally written in a procedural style; SAS code is almost always procedural.</li>
<li>
<strong>Declarative languages</strong> use code to describe the problem that needs to be solved, and the language figures out how to solve it. SQL is the most common declarative language you’ll encounter for data-related tasks.</li>
<li>
<strong>Object oriented</strong> languages (sometimes abbreviated OOP, for object-oriented programming) manipulate collections of objects or classes. Data is stored in classes that have associated functions, which are often called methods. Java is explicitly object-oriented; C++ and Python support object-oriented programming but don’t force you to use those features.</li>
<li>
<strong>Functional</strong> programming languages describe a problem using a set of functions, which only take inputs and produce outputs. Functions don’t have any internal tracking of <strong>state</strong> - purely functional languages move from input to output without storing variables or even printing output to the command line, but it is common to adopt a functional approach to programming without requiring strict adherence to all principles of a fully functional approach. Haskell and Rust are fairly standard functional programming languages.</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="youtube-video-container">
<p>Hadley’s talk on The Joy of Functional Programming for Data Science</p>
<iframe width="640" height="360" src="https://www.youtube.com/embed/bzUmK0Y07ck" title="&quot;The Joy of Functional Programming (for Data Science)&quot; with Hadley Wickham" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div></div><p>Functional programming languages have a goal of writing <strong>pure functions</strong> - functions that do not change the global state (stuff stored in objects, memory, parameters, or files) of the program and thus have no side effects. The return value of a pure function is based solely on the inputs to the function. Not all functions can be pure functions - for instance, there’s no pure way to do file IO operations. But it is a nice goal to be able to move parameters into functions and have the correct object returned from that function, so that you can pipe multiple operations together into a pipeline.</p>
<p>Most general-purpose languages like C++ and Python and even some domain languages like R support multiple different programming paradigms. While preparing to write this chapter, I saw functional programming books with examples in Java <span class="citation" data-cites="urmaModernJavaAction2018"><a href="#ref-urmaModernJavaAction2018" role="doc-biblioref">[2]</a></span>, JavaScript <span class="citation" data-cites="FPJS"><a href="#ref-FPJS" role="doc-biblioref">[3]</a></span>, and C# <span class="citation" data-cites="buonannoFunctionalProgrammingHow2017"><a href="#ref-buonannoFunctionalProgrammingHow2017" role="doc-biblioref">[4]</a></span> - all languages that I would associate with OOP or procedural styles. I also found books teaching object oriented programming using Fortran 90-95 <span class="citation" data-cites="OOPfortran"><a href="#ref-OOPfortran" role="doc-biblioref">[5]</a></span>, which is something I wouldn’t have considered possible.</p>
<p>All of this is to say that while certain languages are built around principles like OOP or functional programming, almost every language has users who rely more heavily on one approach than the other. There are very few “pure” programming languages, which reminds me of one of my favorite quotes about English:</p>
<blockquote class="blockquote">
<p>“The problem with defending the purity of the English language is that English is about as pure as a cribhouse whore. We don’t just borrow words; on occasion, English has pursued other languages down alleyways to beat them unconscious and rifle their pockets for new vocabulary.” ― <a href="https://www.goodreads.com/quotes/694108-the-problem-with-defending-the-purity-of-the-english-language">James D. Nicoll</a></p>
</blockquote>
<div class="callout-demo callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Object Oriented Philosophy in R and Python
</div>
</div>
<div class="callout-body-container callout-body">
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">R</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>When you call <code>df.size()</code> in Python, you are calling the <code>size</code> method that is part of the <code>df</code> object, which is a <code>DataFrame</code>. This suggests that Pandas, at least, is programmed using an object-oriented paradigm.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<!-- R is a bit of a trickier case.  -->
<!-- R has several different types of object-oriented structures that we usually avoid talking about until you start looking at developing your own R packages.  -->
<!-- R also was designed by people who enjoyed using Lisp - another multi-paradigm approach that accommodates functional programming, procedural programming, and object-oriented programming.  -->
<p>An easy example of R’s object oriented nature is that when you fit different models or perform different tests, the default output is different.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">~</span><span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Welch Two Sample t-test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  mtcars$mpg by mtcars$vs</span></span>
<span><span class="co">## t = -4.6671, df = 22.716, p-value = 0.0001098</span></span>
<span><span class="co">## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  -11.462508  -4.418445</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">## mean in group 0 mean in group 1 </span></span>
<span><span class="co">##        16.61667        24.55714</span></span>
<span></span>
<span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = mtcars$mpg ~ mtcars$vs)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## (Intercept)    mtcars$vs  </span></span>
<span><span class="co">##       16.62         7.94</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output is different because each test/regression model object has a different print method, which allows R to create different output for each type of object.</p>
</div>
</div>
</div>
</div>
</div>
<p>Functional programming allows us to write programs that are more modular, and thus, are easier to test and debug. In addition, functional programming encourages you to think about data <strong>pipelines</strong>: a sequence of steps that are reproducible and reusable for different data sets and analyses. Functional programming is convenient for another (more esoteric, but important) reason - it allows you to prove that a function or series of functions is actually correct (rather than just testing input/output combinations).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../images/wrangling/functional-pipeline.png" class="img-fluid figure-img" alt="Cute fuzzy monsters putting rectangular data tables onto a conveyor belt. Along the conveyor belt line are different automated “stations” that update the data. A monster at the end of the conveyor belt is carrying away a table that reads “Complete analysis.”"></p>
<p></p><figcaption class="figure-caption">A pipeline of functional data analysis. Each function (station) modifies the data in some way and the returned result is passed into the next function (station) as input. This allows a sequence of functions to format data, visualize it, model it, and then package the results. While this paradigm doesn’t require a functional approach, functional programming does make it simpler. Modified from <a href="https://github.com/allisonhorst/stats-illustrations">Allison Horst’s work</a></figcaption><p></p>
</figure>
</div>
<p>If you have been using the R pipe (<code>|&gt;</code> or <code>%&gt;%</code>), you didn’t realize it, but you were already using functional programming. Piping results from one function to another in a chain is a prime example of the “pure function” idea - it allows us to chain each step of a sequence together to create a sequence that is modular and testable.</p>
<div class="callout-demo callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
A simple Functional Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>functional</strong> is a function that takes another function as input and returns a vector as output.</p>
<p>One simple example of a functional that is found in both R and Python is the <code>apply</code> function (or variants in R like <code>lapply</code>, <code>sapply</code>, <code>tapply</code>). In Python, <code>.apply</code> is a method in Pandas, but we can find an even more low-level equivalent in the ideas of <strong>list comprehensions</strong> and <strong>map</strong> functions.</p>
<p>One additional concept that is helpful before we start is the idea of a <strong>lambda</strong> function - a small anonymous function (that is, a function that is not named or stored in a variable). Lambda functions are great for filling in default arguments, but they have many other uses as well.</p>
<p>Can you identify the lambda functions in each of the following examples?</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>This code generates 5 draws from a normal random variable with the specified mean and standard deviation 1.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] -0.3088265  1.5694417  1.9794627  1.4230934  0.8597201</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 3.148141 2.348842 2.692981 3.532100 1.265144</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] 3.897947 2.773942 3.787399 2.847090 2.847522</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] 5.739582 3.037043 4.206080 3.164577 4.054159</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] 4.243527 4.157632 5.259806 5.239401 6.942975</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or, if you have R 4.1.0 or above, you can use a shorthand version:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, mean <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1]  2.6677651  1.7487203  1.1620578 -0.9882784  2.0402249</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] 3.6291126 1.6311020 0.8788967 2.5445883 3.9446435</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] 1.9708418 3.5571403 3.0802457 2.4471411 0.9782797</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] 3.971871 5.943827 5.303621 5.628560 3.938471</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] 4.727726 5.305644 5.120091 5.834884 3.986982</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>\(x)</code> is shorthand for <code>function(x)</code> and allows you to quickly and easily define anonymous functions in R.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>This code generates 5 draws from a normal random variable with the specified mean and standard deviation 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># List comprehension approach</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> [np.random.normal(i, size <span class="op">=</span> <span class="dv">5</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>)]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r1) </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Functional approach</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining a lambda function allows us to fill in non-default options</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">## [array([ 1.59141358, -1.65607465,  2.13806991,  1.92000031,  0.30985454]), array([ 3.48554851,  2.29486135, -0.45243317,  3.11728773,  2.19740571]), array([2.24742712, 3.51626283, 1.75094264, 3.11797465, 2.10780845]), array([2.54562356, 2.84850516, 3.41585896, 3.19512841, 4.61058435]), array([3.66286109, 6.79963786, 5.11137858, 4.60808487, 3.7350454 ])]</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> a: np.random.normal(a, size <span class="op">=</span> <span class="dv">5</span>), <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This is what map spits out by default</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># get your results back out with list()</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">## &lt;map object at 0x7f87f08063b0&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>r2b <span class="op">=</span> <span class="bu">list</span>(r2) </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2b)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">## [array([0.53502377, 1.64922962, 1.13431903, 2.33985784, 0.50398161]), array([1.66400124, 2.93397094, 2.44611091, 1.50056041, 2.47807214]), array([3.8513644 , 4.18239281, 3.97791825, 1.68851075, 1.66951926]), array([3.40023584, 3.2128916 , 5.58003128, 4.0202558 , 4.7475622 ]), array([5.77766386, 4.94127141, 4.73065734, 5.10744919, 4.32758783])]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="replacing-loops-with-functional-programming" class="level2 page-columns page-full" data-number="24.2"><h2 data-number="24.2" class="anchored" data-anchor-id="replacing-loops-with-functional-programming">
<span class="header-section-number">24.2</span> Replacing Loops with Functional Programming</h2>
<p>One really convenient application of functional programming is to replace loops. As Hadley Wickham says in <span class="citation" data-cites="advr"><a href="#ref-advr" role="doc-biblioref">[6]</a></span>,</p>
<blockquote class="blockquote">
<p>the real downside of for loops is that they’re very flexible: a loop conveys that you’re iterating, but not what should be done with the results</p>
</blockquote>
<p>That is, in many cases when programming with data, what we want is to iterate over a vector and return a vector of results. This is a <em>perfect</em> use case for functional programming, since we’re specifying both that we’re iterating AND more explicitly collecting the results into a form that makes sense.</p>
<p>If we work with this definition of functional programming, then python list comprehensions are also a functional approach: they specify how the results are collected (usually by putting <code>[]</code> around the statement) and how the iteration will occur <span class="citation" data-cites="rituraj_jainNestedListComprehensions2018"><a href="#ref-rituraj_jainNestedListComprehensions2018" role="doc-biblioref">[7]</a></span>.</p>
<p>Let’s look at a few examples.</p>
<div class="callout-demo callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Demo
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose we want to look at the Lego data and create a decade variable that describes the decade a set was first released.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">base R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">R: <code>purrr</code></a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lego</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/lego_sets.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span><span class="op">$</span><span class="va">decade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">lego</span><span class="op">$</span><span class="va">year</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lego</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"set_num"</span>, <span class="st">"name"</span>, <span class="st">"year"</span>, <span class="st">"decade"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">##   set_num                       name year decade</span></span>
<span><span class="co">## 1   001-1                      Gears 1965   1960</span></span>
<span><span class="co">## 2  0011-2          Town Mini-Figures 1979   1970</span></span>
<span><span class="co">## 3  0011-3 Castle 2 for 1 Bonus Offer 1987   1980</span></span>
<span><span class="co">## 4  0012-1         Space Mini-Figures 1979   1970</span></span>
<span><span class="co">## 5  0013-1         Space Mini-Figures 1979   1970</span></span>
<span><span class="co">## 6  0014-1         Space Mini-Figures 1979   1970</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Strictly speaking, this use of <code>sapply</code> isn’t necessary - because R is vectorized by default, we could also have used <code>lego$decade &lt;- floor(lego$year/10)*10</code>. However, there are functions in R that are not fully vectorized, and it is useful to know this approach for those use-cases as well, and it’s easier to demonstrate this approach with a relatively simple use case.</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>In purrr, you can create anonymous functions using <code>~</code> with <code>.</code> as a placeholder. If you need more parameters, you can use <code>.x</code>, <code>.y</code> and <code>map2</code> (for now) or <code>.1</code>, <code>.2</code>, <code>.3</code>, <code>...</code> with <code>pmap</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/lego_sets.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span> <span class="op">&lt;-</span> <span class="va">lego</span> <span class="op">|&gt;</span> <span class="co"># Either pipe will work here</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>decade <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span><span class="va">year</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lego</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">set_num</span>, <span class="va">name</span>, <span class="va">year</span>, <span class="va">decade</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 4</span></span>
<span><span class="co">##   set_num name                        year decade</span></span>
<span><span class="co">##   &lt;chr&gt;   &lt;chr&gt;                      &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">## 1 001-1   Gears                       1965   1960</span></span>
<span><span class="co">## 2 0011-2  Town Mini-Figures           1979   1970</span></span>
<span><span class="co">## 3 0011-3  Castle 2 for 1 Bonus Offer  1987   1980</span></span>
<span><span class="co">## 4 0012-1  Space Mini-Figures          1979   1970</span></span>
<span><span class="co">## 5 0013-1  Space Mini-Figures          1979   1970</span></span>
<span><span class="co">## 6 0014-1  Space Mini-Figures          1979   1970</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: ModuleNotFoundError: No module named 'pandas'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>lego <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/lego_sets.csv"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'pd' is not defined</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>lego[<span class="st">'decade'</span>] <span class="op">=</span> [math.floor(i<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span> <span class="cf">for</span> i <span class="kw">in</span> lego.year]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'lego' is not defined</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>lego[[<span class="st">'set_num'</span>, <span class="st">'name'</span>, <span class="st">'year'</span>, <span class="st">'decade'</span>]].head()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'lego' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>For a more interesting example, though, let’s consider fitting a different linear regression for each generation of Pokemon, describing the relationship between HP (hit points) and CP (combat power, aka <code>total</code> in this dataset).</p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example: Pokemon modeling
</div>
</div>
<div class="callout-body-container callout-body">
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">base R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Tidy R</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Python</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span></span>
<span><span class="co"># Get rid of mega pokemon - they're a different thing</span></span>
<span><span class="va">poke</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">poke</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Mega"</span>, <span class="va">poke</span><span class="op">$</span><span class="va">variant</span><span class="op">)</span><span class="op">)</span> <span class="co"># step 1</span></span>
<span></span>
<span><span class="co"># Split into a list of data frames from each gen</span></span>
<span><span class="va">poke_gens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">poke</span>, <span class="va">poke</span><span class="op">$</span><span class="va">gen</span><span class="op">)</span> <span class="co"># step 2</span></span>
<span></span>
<span><span class="co"># Fit linear regressions for each generation of pokemon</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">poke_gens</span>, \<span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="co"># step 3</span></span>
<span></span>
<span><span class="co"># Pull out coefficients and r-squared values</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">models</span>, \<span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>coef1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, coef2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, rsq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span><span class="op">)</span>  <span class="co"># step 4</span></span>
<span></span>
<span><span class="co"># Join the results back into a data.frame</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">results</span><span class="op">)</span> <span class="co"># step 5</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">##      coef1    coef2       rsq</span></span>
<span><span class="co">## 1 262.4730 2.394032 0.3895255</span></span>
<span><span class="co">## 2 258.5815 2.133868 0.3165292</span></span>
<span><span class="co">## 3 245.3375 2.753912 0.2686807</span></span>
<span><span class="co">## 4 268.5792 2.792350 0.3500187</span></span>
<span><span class="co">## 5 189.1339 3.506458 0.5578802</span></span>
<span><span class="co">## 6 252.7434 2.798942 0.5278159</span></span>
<span><span class="co">## 7 234.9329 3.293730 0.4382885</span></span>
<span><span class="co">## 8 205.2726 3.500811 0.6042219</span></span>
<span><span class="co">## 9 236.8656 2.757408 0.4757028</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Data in data frame</li>
<li>Data split into a list of data frames</li>
<li>Models in a list corresponding to data in step 2</li>
<li>Results in a list of data frames corresponding to models in step 3</li>
<li>Bind results in step 4 back into a data frame</li>
</ol>
<p>In each step, we specify not only what the iterative action should be, but also what form the results will take.</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>In the tidyverse, we use <code><a href="https://tidyr.tidyverse.org/reference/nest.html">tidyr::nest()</a></code> to accomplish a similar thing to <code>split</code> in base R.</p>
<p>This approach is designed to work entirely within a single data frame, which keeps the environment relatively clean and ensures that each step’s results are stored in a convenient, easy-to-find place.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/pokemon_gen_1-9.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># str_detect doesn't play nice with NAs, so replace NA with ""</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>variant <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">variant</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Remove mega pokemon</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">variant</span>, <span class="st">"Mega"</span>, negate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 1</span></span>
<span>  <span class="co"># Sub-data-frames</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="va">gen</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 2</span></span>
<span>  <span class="co"># Fit model</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">data</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 3</span></span>
<span>  <span class="co"># Extract coefficients</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>coef1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>                                      coef2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                                      rsq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># step 4</span></span>
<span>  <span class="co"># Bind together</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span> <span class="co"># step 5</span></span>
<span><span class="va">res</span></span>
<span><span class="co">## # A tibble: 9 × 6</span></span>
<span><span class="co">##     gen data                model  coef1 coef2   rsq</span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;list&gt;              &lt;list&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1     1 &lt;tibble [269 × 15]&gt; &lt;lm&gt;    262.  2.39 0.390</span></span>
<span><span class="co">## 2     2 &lt;tibble [118 × 15]&gt; &lt;lm&gt;    259.  2.13 0.317</span></span>
<span><span class="co">## 3     3 &lt;tibble [173 × 15]&gt; &lt;lm&gt;    245.  2.75 0.269</span></span>
<span><span class="co">## 4     4 &lt;tibble [173 × 15]&gt; &lt;lm&gt;    269.  2.79 0.350</span></span>
<span><span class="co">## 5     5 &lt;tibble [236 × 15]&gt; &lt;lm&gt;    189.  3.51 0.558</span></span>
<span><span class="co">## 6     6 &lt;tibble [118 × 15]&gt; &lt;lm&gt;    253.  2.80 0.528</span></span>
<span><span class="co">## 7     7 &lt;tibble [133 × 15]&gt; &lt;lm&gt;    235.  3.29 0.438</span></span>
<span><span class="co">## 8     8 &lt;tibble [134 × 15]&gt; &lt;lm&gt;    205.  3.50 0.604</span></span>
<span><span class="co">## 9     9 &lt;tibble [123 × 15]&gt; &lt;lm&gt;    237.  2.76 0.476</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our data takes the form:</p>
<ol type="1">
<li>An ungrouped data frame</li>
<li>A data frame with 9 rows, one for each generation, with a list-column <code>data</code> that contains the full data for each generation</li>
<li>We fit our model and store the model results into another list-column named <code>model</code> that contains the fitted model object</li>
<li>We define some summary information and store it into a list-column containing each 1-row data frame</li>
<li>We “unnest” the summary information, which is equivalent to bringing the columns we defined up to the primary level and binding the rows together.</li>
</ol>
<p>At each step, we’re specifying the form of the results along with the contents.</p>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>This construct of storing everything inside a single data frame isn’t as common in Python, but we can make it work with only a little extra effort.</p>

<p>You will need to <code>pip install statsmodels</code> to get the <code>statsmodels</code> <span class="citation" data-cites="seabold2010statsmodels"><a href="#ref-seabold2010statsmodels" role="doc-biblioref">[8]</a></span> package that implements many basic statistical models. The <code>scikit-learn</code> package <span class="citation" data-cites="scikitlearn"><a href="#ref-scikitlearn" role="doc-biblioref">[9]</a></span> is another commonly used package <span class="citation" data-cites="menonLinearRegressionLines2018"><a href="#ref-menonLinearRegressionLines2018" role="doc-biblioref">[10]</a></span>, but it does not have the easy accessor functions to pull out e.g.&nbsp;coefficients and r-squared values, so we’ll use <code>statsmodels</code> here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: ModuleNotFoundError: No module named 'pandas'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.formula.api <span class="im">import</span> ols</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to fit a linear regression</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># There is probably a better way to do this flexibly,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># but this approach is simple and useful for illustrative purposes</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: ModuleNotFoundError: No module named 'statsmodels'</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pokereg(data):</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=</span> data[[<span class="st">"hp"</span>]].values</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> data[[<span class="st">"total"</span>]].values</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  model <span class="op">=</span> ols(<span class="st">'total ~ hp'</span>, data)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  results <span class="op">=</span> model.fit()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> results</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/srvanderplas/datasets/main/clean/pokemon_gen_1-9.csv"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with ""</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'pd' is not defined</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>res[<span class="st">"variant"</span>] <span class="op">=</span> [<span class="st">""</span> <span class="cf">if</span> pd.isna(i) <span class="cf">else</span> i <span class="cf">for</span> i <span class="kw">in</span> res.variant]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove mega pokemon</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res' is not defined</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> res.query(<span class="st">'~(variant.str.contains("(?:^[mM]ega)"))'</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Group data frames and apply regression function to each group</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res' is not defined</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>res_reg <span class="op">=</span> (</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  res <span class="co"># step 1</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"gen"</span>) <span class="co"># step 2</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(pokereg) <span class="co"># step 3</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Make results into a dataframe and rename the column as 'results'</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res' is not defined</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>res_reg <span class="op">=</span> pd.DataFrame(res_reg).rename(columns <span class="op">=</span> {<span class="dv">0</span>:<span class="st">'results'</span>}) <span class="co"># step 4</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Get values of interest and store in new columns # step 5</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'pd' is not defined</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>res_reg <span class="op">=</span> res_reg.reset_index() <span class="co"># store gen in its own column</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res_reg' is not defined</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>res_reg[<span class="st">'coef1'</span>] <span class="op">=</span> res_reg.results.<span class="bu">map</span>(<span class="kw">lambda</span> x: x.params[<span class="dv">0</span>])</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res_reg' is not defined</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>res_reg[<span class="st">'coef2'</span>] <span class="op">=</span> res_reg.results.<span class="bu">map</span>(<span class="kw">lambda</span> x: x.params[<span class="dv">1</span>])</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res_reg' is not defined</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>res_reg[<span class="st">'rsq'</span>] <span class="op">=</span> res_reg.results.<span class="bu">map</span>(<span class="kw">lambda</span> x: x.rsquared)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res_reg' is not defined</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>res_reg[[<span class="st">'gen'</span>, <span class="st">'coef1'</span>, <span class="st">'coef2'</span>, <span class="st">'rsq'</span>]]</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">## Error: NameError: name 'res_reg' is not defined</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While this doesn’t store our data in the same DataFrame as the model results, we do have a key that links the two: the <code>gen</code> variable is present in both <code>res</code> and <code>res_reg</code> and can be used to join the data to the regression results, if necessary.</p>
<ol type="1">
<li>Data in an ungrouped data frame</li>
<li>We group by <code>gen</code> (generation)</li>
<li>We apply the function <code>pokereg</code> to fit a linear regression, and the results are stored in an indexed Series where the index corresponds to <code>gen</code>.</li>
<li>We make the results into a DataFrame so that we can add extra columns, and rename the automatically created Series to <code>results</code> to be more descriptive</li>
<li>We create summary information and store the summaries in columns in the data frame.</li>
</ol>
<p>While the grouping and binding operations are in a different order in Python than in R, the basic specification of the structure of the output each time we iterate is similar.</p>
</div>
</div>
</div>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-margin-content">
<p>I am sure that the python code I’ve written here is a bit kludgy if you are more fluent in python/pandas than I am, so please feel free to submit a pull request to fix it if you know a better or more “pretty” way to do this.</p>
</div></div></section><section id="references" class="level2" data-number="24.3"><h2 data-number="24.3" class="anchored" data-anchor-id="references">
<span class="header-section-number">24.3</span> References</h2>


<div id="refs" class="references csl-bib-body" role="doc-bibliography">
<div id="ref-kuchlingFunctionalProgrammingHOWTO2022" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">A. M. Kuchling, <span>“Functional programming <span>HOWTO</span>. <span class="nocase">cPython</span> documentation,”</span> Oct. 31, 2022. [Online]. Available: <a href="https://docs.python.org/3/howto/functional.html">https://docs.python.org/3/howto/functional.html</a>. [Accessed: Mar. 20, 2023]</div>
</div>
<div id="ref-urmaModernJavaAction2018" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[2] </div>
<div class="csl-right-inline">R.-G. Urma, M. Fusco, and A. Mycroft, <em>Modern java in action: Lambdas, streams, functional and reactive programming</em>, 2nd edition. Shelter Island: Manning, 2018. </div>
</div>
<div id="ref-FPJS" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[3] </div>
<div class="csl-right-inline">M. Fogus, <em>Functional <span>JavaScript</span>: Introducing functional programming with underscore.js</em>, 1st edition. Sebastopol, <span>CA</span>: O’Reilly Media, 2013. </div>
</div>
<div id="ref-buonannoFunctionalProgrammingHow2017" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[4] </div>
<div class="csl-right-inline">E. Buonanno, <em>Functional programming in c#: How to write better c# code</em>, 1st edition. Shelter Island, <span>NY</span>: Manning, 2017. </div>
</div>
<div id="ref-OOPfortran" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[5] </div>
<div class="csl-right-inline">E. Akin, <em>Object-oriented programming via fortran 90-95</em>. Cambridge University Press, 2003 [Online]. Available: <a href="http://gen.lib.rus.ec/book/index.php?md5=2d996a202fdd840e79a791a4eb854432">http://gen.lib.rus.ec/book/index.php?md5=2d996a202fdd840e79a791a4eb854432</a>
</div>
</div>
<div id="ref-advr" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[6] </div>
<div class="csl-right-inline">H. Wickham, <em>Advanced <span>R</span></em>, 2nd ed. CRC Press, 2019 [Online]. Available: <a href="http://adv-r.had.co.nz/">http://adv-r.had.co.nz/</a>. [Accessed: May 09, 2022]</div>
</div>
<div id="ref-rituraj_jainNestedListComprehensions2018" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[7] </div>
<div class="csl-right-inline">rituraj_jain, <span>“Nested list comprehensions in python. <span>GeeksforGeeks</span>,”</span> Nov. 07, 2018. [Online]. Available: <a href="https://www.geeksforgeeks.org/nested-list-comprehensions-in-python/">https://www.geeksforgeeks.org/nested-list-comprehensions-in-python/</a>. [Accessed: Mar. 20, 2023]</div>
</div>
<div id="ref-seabold2010statsmodels" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[8] </div>
<div class="csl-right-inline">S. Seabold and J. Perktold, <span>“Statsmodels: Econometric and statistical modeling with python,”</span> in <em>9th python in science conference</em>, 2010 [Online]. Available: <a href="https://conference.scipy.org/proceedings/scipy2010/pdfs/seabold.pdf">https://conference.scipy.org/proceedings/scipy2010/pdfs/seabold.pdf</a>
</div>
</div>
<div id="ref-scikitlearn" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[9] </div>
<div class="csl-right-inline">F. Pedregosa <em>et al.</em>, <span>“Scikit-learn: Machine learning in python,”</span> <em>Journal of Machine Learning Research</em>, vol. 12, pp. 2825–2830, 2011. </div>
</div>
<div id="ref-menonLinearRegressionLines2018" class="csl-entry" role="doc-biblioentry">
<div class="csl-left-margin">[10] </div>
<div class="csl-right-inline">A. Menon, <span>“Linear regression in 6 lines of python. Medium,”</span> Oct. 25, 2018. [Online]. Available: <a href="https://towardsdatascience.com/linear-regression-in-6-lines-of-python-5e1d0cd05b8d">https://towardsdatascience.com/linear-regression-in-6-lines-of-python-5e1d0cd05b8d</a>. [Accessed: Oct. 17, 2022]</div>
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="srvanderplas/stat-computing-r-python" data-repo-id="R_kgDOIvwd2g" data-category="General" data-category-id="DIC_kwDOIvwd2s4CTksR" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../part-wrangling/07-datetime.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Dates and Times</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../part-wrangling/09-spatial-formats.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Spatial data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Susan Vanderplas</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/srvanderplas">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/srvanderplas">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>